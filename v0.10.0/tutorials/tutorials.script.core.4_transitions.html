
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="../_static/images/Chatsky-min-light.svg" rel="icon" type="image/svg+xml">
    <title>Core: 4. Transitions &#8212; chatsky 0.10.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/katex-math.css?v=91adb8b6" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=b77b6cac" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=82662543"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/katex.min.js?v=be8ff15f"></script>
    <script src="../_static/auto-render.min.js?v=ad136472"></script>
    <script src="../_static/katex_autorenderer.js?v=bebc588a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^1.0.1/dist/embed-amd.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tutorials/tutorials.script.core.4_transitions';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.0';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://deeppavlov.github.io/chatsky/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v0.10.0';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Core: 5. Global and Local nodes" href="tutorials.script.core.5_global_local.html" />
    <link rel="prev" title="Core: 3. Responses" href="tutorials.script.core.3_responses.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.10" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/Chatsky-full-dark.svg" class="logo__image only-light" alt="chatsky 0.10.0 documentation - Home"/>
    <img src="../_static/Chatsky-full-dark.svg" class="logo__image only-dark pst-js-only" alt="chatsky 0.10.0 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../get_started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guides.html">
    User guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    API reference
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../development.html">
    Development
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../community.html">
    Community
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../about_us.html">
    About us
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
        </div>
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://forum.deeppavlov.ai" title="DeepPavlov Forum" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/images/logo-deeppavlov.svg" class="icon-link-image" alt="DeepPavlov Forum"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://t.me/DeepPavlovDreamDiscussions" title="Telegram" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Telegram</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/deeppavlov/chatsky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
    </div>
  
    <div class="navbar-persistent--mobile">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../get_started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guides.html">
    User guides
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../tutorials.html">
    Tutorials
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference.html">
    API reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../development.html">
    Development
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../community.html">
    Community
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../about_us.html">
    About us
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://forum.deeppavlov.ai" title="DeepPavlov Forum" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="../_static/images/logo-deeppavlov.svg" class="icon-link-image" alt="DeepPavlov Forum"/></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://t.me/DeepPavlovDreamDiscussions" title="Telegram" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-telegram fa-lg" aria-hidden="true"></i>
            <span class="sr-only">Telegram</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/deeppavlov/chatsky" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="index_context_storages.html">Context Storages</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.1_basics.html">1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.2_postgresql.html">2. PostgreSQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.3_mongodb.html">3. MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.4_redis.html">4. Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.5_mysql.html">5. MySQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.6_sqlite.html">6. SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.7_yandex_database.html">7. Yandex DataBase</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.8_partial_updates.html">8. Partial context updates</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.context_storages.9_db_benchmarking.html">9. Context storage benchmarking</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_interfaces.html">Interfaces</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.telegram.1_basic.html">Telegram: 1. Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.telegram.2_attachments.html">Telegram: 2. Attachments</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.telegram.3_advanced.html">Telegram: 3. Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.web_api_interface.1_fastapi.html">Web API: 1. FastAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.web_api_interface.2_websocket_chat.html">Web API: 2. WebSocket Chat</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.web_api_interface.3_load_testing_with_locust.html">Web API: 3. Load testing with Locust</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.messengers.web_api_interface.4_streamlit_chat.html">Web API: 4. Streamlit chat interface</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_llm_integration.html">LLM Integration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.llm.1_basics.html">LLM: 1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.llm.2_prompt_usage.html">LLM: 2. Prompt Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.llm.3_filtering_history.html">LLM: 3. Filtering History</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.llm.4_structured_output.html">LLM: 4. Structured Output</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index_script.html">Script</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.1_basics.html">Core: 1. Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.2_conditions.html">Core: 2. Conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.3_responses.html">Core: 3. Responses</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Core: 4. Transitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.5_global_local.html">Core: 5. Global and Local nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.6_context_serialization.html">Core: 6. Context serialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.7_pre_response_processing.html">Core: 7. Pre-response processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.8_misc.html">Core: 8. Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.core.9_pre_transition_processing.html">Core: 9. Pre-transition processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.responses.1_media.html">Responses: 1. Media</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.script.responses.2_multi_message.html">Responses: 2. Multi Message</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_service.html">Service</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.service.1_basics.html">1. Basic services</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.service.2_advanced.html">2. Advanced services</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.service.3_groups.html">3. Service Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.service.4_conditions_and_paths.html">4. Conditions and paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.service.5_extra_handlers.html">5. Extra handlers</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_slots.html">Slots</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.slots.1_basic_example.html">1. Basic Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.slots.2_partial_extraction.html">2. Partial slot extraction</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="index_stats.html">Stats</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.stats.1_extractor_functions.html">1. Extractor Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.stats.2_pipeline_integration.html">2. Pipeline Integration</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../tutorials.html" class="nav-link">Tutorials</a></li>
    
    
    <li class="breadcrumb-item"><a href="index_script.html" class="nav-link">Script</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Core: 4. Transitions</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Core:-4.-Transitions">
<h1>Core: 4. Transitions<a class="headerlink" href="#Core:-4.-Transitions" title="Link to this heading">#</a></h1>
<p>This tutorial shows settings for transitions between flows and nodes.</p>
<p>Here, <a class="reference internal" href="../apiref/chatsky.conditions.standard.html"><span class="doc">conditions</span></a> for transition between many different script steps are shown.</p>
<p>Some of the destination steps can be set using <a class="reference internal" href="../apiref/chatsky.destinations.standard.html"><span class="doc">destinations</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># installing dependencies</span>
<span class="o">%</span><span class="k">pip</span> install -q chatsky==0.10.0
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Note: you may need to restart the kernel to use updated packages.
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">chatsky</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TRANSITIONS</span><span class="p">,</span>
    <span class="n">RESPONSE</span><span class="p">,</span>
    <span class="n">Context</span><span class="p">,</span>
    <span class="n">NodeLabelInitTypes</span><span class="p">,</span>
    <span class="n">Pipeline</span><span class="p">,</span>
    <span class="n">Transition</span> <span class="k">as</span> <span class="n">Tr</span><span class="p">,</span>
    <span class="n">BaseDestination</span><span class="p">,</span>
    <span class="n">conditions</span> <span class="k">as</span> <span class="n">cnd</span><span class="p">,</span>
    <span class="n">destinations</span> <span class="k">as</span> <span class="n">dst</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">chatsky.utils.testing.common</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">check_happy_path</span><span class="p">,</span>
    <span class="n">is_interactive_mode</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">TRANSITIONS</span></code> keyword is used to determine a list of transitions from the current node. After receiving user request, Pipeline will choose the next node relying on that list. If no transition in the list is suitable, transition will be made to the fallback node.</p>
<p>Each transition is represented by the <a class="reference internal" href="../apiref/chatsky.core.transition.html#chatsky.core.transition.Transition"><span class="std std-ref">Transition</span></a> class.</p>
<p>It has three main fields:</p>
<ul class="simple">
<li><p>dst: Destination determines the node to which the transition is made.</p></li>
<li><p>cnd: Condition determines if the transition is allowed.</p></li>
<li><p>priority: Allows choosing one of the transitions if several are allowed. Higher priority transitions will be chosen over the rest. If priority is not set, <a class="reference internal" href="../apiref/chatsky.core.pipeline.html#chatsky.core.pipeline.Pipeline.default_priority"><span class="std std-ref">default_priority</span></a> is used instead. Default priority is 1 by default (but may be set via Pipeline).</p></li>
</ul>
<p>For more details on how the next node is chosen see <a class="reference internal" href="../apiref/chatsky.core.transition.html#chatsky.core.transition.get_next_label"><span class="std std-ref">here</span></a>.</p>
<p>Like conditions, all of these fields can be either constant values or custom functions (<a class="reference internal" href="../apiref/chatsky.core.script_function.html#chatsky.core.script_function.BaseDestination"><span class="std std-ref">BaseDestination</span></a>, <a class="reference internal" href="../apiref/chatsky.core.script_function.html#chatsky.core.script_function.BaseCondition"><span class="std std-ref">BaseCondition</span></a>, <a class="reference internal" href="../apiref/chatsky.core.script_function.html#chatsky.core.script_function.BasePriority"><span class="std std-ref">BasePriority</span></a>).</p>
<section id="Destinations">
<h2>Destinations<a class="headerlink" href="#Destinations" title="Link to this heading">#</a></h2>
<p>Destination node is specified with a <a class="reference internal" href="../apiref/chatsky.core.node_label.html#chatsky.core.node_label.NodeLabel"><span class="std std-ref">NodeLabel</span></a> class.</p>
<p>It contains two field:</p>
<ul class="simple">
<li><p>“flow_name”: Name of the flow the node belongs to. Optional; if not set, will use the flow of the current node.</p></li>
<li><p>“node_name”: Name of the node inside the flow.</p></li>
</ul>
<p>Instances of this class can be initialized from a tuple of two strings (flow name and node name) or a single string (node name; relative flow name). This happens automatically for return values of <code class="docutils literal notranslate"><span class="pre">BaseDestination</span></code> and for the <code class="docutils literal notranslate"><span class="pre">dst</span></code> field of <code class="docutils literal notranslate"><span class="pre">Transition</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">GreetingFlowNode2</span><span class="p">(</span><span class="n">BaseDestination</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">Context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NodeLabelInitTypes</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;greeting_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node2&quot;</span>
</pre></div>
</div>
</div>
<p>Chatsky provides several basic transitions as part of the <a class="reference internal" href="../apiref/chatsky.destinations.standard.html"><span class="doc">standard</span></a> module:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FromHistory</span></code> returns a node from label history. <code class="docutils literal notranslate"><span class="pre">Current</span></code> and <code class="docutils literal notranslate"><span class="pre">Previous</span></code> are subclasses of it that return specific nodes (current node and previous node respectively).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Start</span></code> returns the start node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Fallback</span></code> returns the fallback node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Forward</span></code> returns the next node (in order of definition) in the current flow relative to the current node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Backward</span></code> returns the previous node (in order of definition) in the current flow relative to the current node.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_script</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;global_flow&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start_node&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;music_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;talk about music&quot;</span><span class="p">),</span>
                    <span class="c1"># this condition is checked first.</span>
                    <span class="c1"># if it fails, pipeline will try the next transition</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;greeting_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;hi|hello&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="s2">&quot;fallback_node&quot;</span><span class="p">,</span>
                    <span class="c1"># a single string references a node in the same flow</span>
                <span class="p">),</span>
                <span class="c1"># this transition will only be made if previous ones fail</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="s2">&quot;fallback_node&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;Ooops&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;music_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;talk about music&quot;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;greeting_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;hi|hello&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Previous</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;previous&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Current</span><span class="p">(),</span>  <span class="c1"># this goes to the current node</span>
                    <span class="c1"># i.e. fallback node</span>
                <span class="p">),</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;greeting_flow&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;Hi, how are you?&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;global_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;fallback_node&quot;</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="p">),</span>  <span class="c1"># due to low priority (default priority is 1)</span>
                <span class="c1"># this transition will be made if the next one fails</span>
                <span class="n">Tr</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="s2">&quot;node2&quot;</span><span class="p">,</span> <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;how are you&quot;</span><span class="p">)),</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;Good. What do you want to talk about?&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Fallback</span><span class="p">(),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="c1"># there is no need to specify such transition:</span>
                <span class="c1"># For any node if all transitions fail,</span>
                <span class="c1"># fallback node becomes the next node.</span>
                <span class="c1"># Here, this transition exists for demonstration purposes.</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>  <span class="c1"># i.e. &quot;node3&quot; of this flow</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;talk about&quot;</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="p">),</span>  <span class="c1"># this transition is the third candidate</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;music_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node1&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;talk about music&quot;</span><span class="p">),</span>
                <span class="p">),</span>  <span class="c1"># this transition is the first candidate</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Previous</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;previous&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>  <span class="c1"># this transition is the second candidate</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;Sorry, I can not talk about that now.&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span><span class="n">Tr</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span> <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;bye&quot;</span><span class="p">))],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node4&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;Bye&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="s2">&quot;node1&quot;</span><span class="p">,</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;hi|hello&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;music_flow&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;node1&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;I love `System of a Down` group, &quot;</span>
            <span class="s2">&quot;would you like to talk about it?&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;yes|yep|ok&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;System of a Down is an Armenian-American &quot;</span>
            <span class="s2">&quot;heavy metal band formed in 1994.&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Current</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;The band achieved commercial success &quot;</span>
            <span class="s2">&quot;with the release of five studio albums.&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Forward</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Backward</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;back&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">dst</span><span class="o">.</span><span class="n">Current</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
            <span class="p">],</span>
        <span class="p">},</span>
        <span class="s2">&quot;node4&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="n">RESPONSE</span><span class="p">:</span> <span class="s2">&quot;That&#39;s all I know.&quot;</span><span class="p">,</span>
            <span class="n">TRANSITIONS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="n">GreetingFlowNode2</span><span class="p">(),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">Tr</span><span class="p">(</span>
                    <span class="n">dst</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;greeting_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;node4&quot;</span><span class="p">),</span>
                    <span class="n">cnd</span><span class="o">=</span><span class="n">cnd</span><span class="o">.</span><span class="n">Regexp</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;next time&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">),</span>
                    <span class="n">priority</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="p">),</span>  <span class="c1"># &quot;next&quot; is contained in &quot;next_time&quot; so we need higher</span>
                <span class="c1"># priority here.</span>
                <span class="c1"># Otherwise, this transition will never be made</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># testing</span>
<span class="n">happy_path</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;Hi, how are you?&quot;</span><span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;i&#39;m fine, how are you?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Good. What do you want to talk about?&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;talk about music.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;I love `System of a Down` group, &quot;</span> <span class="s2">&quot;would you like to talk about it?&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;System of a Down is &quot;</span>
        <span class="s2">&quot;an Armenian-American heavy metal band formed in 1994.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;next&quot;</span><span class="p">,</span>
        <span class="s2">&quot;The band achieved commercial success &quot;</span>
        <span class="s2">&quot;with the release of five studio albums.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;back&quot;</span><span class="p">,</span>
        <span class="s2">&quot;System of a Down is &quot;</span>
        <span class="s2">&quot;an Armenian-American heavy metal band formed in 1994.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;repeat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;System of a Down is &quot;</span>
        <span class="s2">&quot;an Armenian-American heavy metal band formed in 1994.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;next&quot;</span><span class="p">,</span>
        <span class="s2">&quot;The band achieved commercial success &quot;</span>
        <span class="s2">&quot;with the release of five studio albums.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;next&quot;</span><span class="p">,</span> <span class="s2">&quot;That&#39;s all I know.&quot;</span><span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;next&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Good. What do you want to talk about?&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;previous&quot;</span><span class="p">,</span> <span class="s2">&quot;That&#39;s all I know.&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;next time&quot;</span><span class="p">,</span> <span class="s2">&quot;Bye&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Ooops&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;previous&quot;</span><span class="p">,</span> <span class="s2">&quot;Bye&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Ooops&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;nope&quot;</span><span class="p">,</span> <span class="s2">&quot;Ooops&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;hi&quot;</span><span class="p">,</span> <span class="s2">&quot;Hi, how are you?&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;Ooops&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;previous&quot;</span><span class="p">,</span> <span class="s2">&quot;Hi, how are you?&quot;</span><span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;i&#39;m fine, how are you?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Good. What do you want to talk about?&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span>
        <span class="s2">&quot;let&#39;s talk about something.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Sorry, I can not talk about that now.&quot;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Ok, goodbye.&quot;</span><span class="p">,</span> <span class="s2">&quot;Bye&quot;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="n">script</span><span class="o">=</span><span class="n">toy_script</span><span class="p">,</span>
    <span class="n">start_label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;global_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;start_node&quot;</span><span class="p">),</span>
    <span class="n">fallback_label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;global_flow&quot;</span><span class="p">,</span> <span class="s2">&quot;fallback_node&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">check_happy_path</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">happy_path</span><span class="p">,</span> <span class="n">printout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_interactive_mode</span><span class="p">():</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
USER: text=&#39;hi&#39;
BOT : text=&#39;Hi, how are you?&#39;
USER: text=&#39;i&#39;m fine, how are you?&#39;
BOT : text=&#39;Good. What do you want to talk about?&#39;
USER: text=&#39;talk about music.&#39;
BOT : text=&#39;I love `System of a Down` group, would you like to talk about it?&#39;
USER: text=&#39;yes&#39;
BOT : text=&#39;System of a Down is an Armenian-American heavy metal band formed in 1994.&#39;
USER: text=&#39;next&#39;
BOT : text=&#39;The band achieved commercial success with the release of five studio albums.&#39;
USER: text=&#39;back&#39;
BOT : text=&#39;System of a Down is an Armenian-American heavy metal band formed in 1994.&#39;
USER: text=&#39;repeat&#39;
BOT : text=&#39;System of a Down is an Armenian-American heavy metal band formed in 1994.&#39;
USER: text=&#39;next&#39;
BOT : text=&#39;The band achieved commercial success with the release of five studio albums.&#39;
USER: text=&#39;next&#39;
BOT : text=&#39;That&#39;s all I know.&#39;
USER: text=&#39;next&#39;
BOT : text=&#39;Good. What do you want to talk about?&#39;
USER: text=&#39;previous&#39;
BOT : text=&#39;That&#39;s all I know.&#39;
USER: text=&#39;next time&#39;
BOT : text=&#39;Bye&#39;
USER: text=&#39;stop&#39;
BOT : text=&#39;Ooops&#39;
USER: text=&#39;previous&#39;
BOT : text=&#39;Bye&#39;
USER: text=&#39;stop&#39;
BOT : text=&#39;Ooops&#39;
USER: text=&#39;nope&#39;
BOT : text=&#39;Ooops&#39;
USER: text=&#39;hi&#39;
BOT : text=&#39;Hi, how are you?&#39;
USER: text=&#39;stop&#39;
BOT : text=&#39;Ooops&#39;
USER: text=&#39;previous&#39;
BOT : text=&#39;Hi, how are you?&#39;
USER: text=&#39;i&#39;m fine, how are you?&#39;
BOT : text=&#39;Good. What do you want to talk about?&#39;
USER: text=&#39;let&#39;s talk about something.&#39;
BOT : text=&#39;Sorry, I can not talk about that now.&#39;
USER: text=&#39;Ok, goodbye.&#39;
BOT : text=&#39;Bye&#39;
</pre></div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="tutorials.script.core.3_responses.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Core: 3. Responses</p>
      </div>
    </a>
    <a class="right-next"
       href="tutorials.script.core.5_global_local.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Core: 5. Global and Local nodes</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Destinations">Destinations</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
    
    
    
    
    

    <a href="https://colab.research.google.com/github/deeppavlov/chatsky/blob/gh-pages/v0.10.0/tutorials/tutorials.script.core.4_transitions.ipynb" data-behavior="call-to-action-event" data-response="Run in Google Colab" target="_blank">
        <div id="google-colab-link">
            <span class="pytorch-colab call-to-action-any"></span>
            <div class="call-to-action-desktop-view">Run in Google Colab</div>
            <div class="call-to-action-mobile-view">Colab</div>
        </div>
    </a>

    <a href="../tutorials/tutorials.script.core.4_transitions.ipynb" data-behavior="call-to-action-event" data-response="Download Notebook">
        <div id="download-notebook-link">
            <span class="pytorch-download call-to-action-any"></span>
            <div class="call-to-action-desktop-view">Download Notebook</div>
            <div class="call-to-action-mobile-view">Notebook</div>
        </div>
    </a>

    <a href="https://github.com/deeppavlov/chatsky/blob/v0.10.0/tutorials/script/core/4_transitions.py" data-behavior="call-to-action-event" data-response="View on Github" target="_blank">
        <div id="github-view-link">
            <span class="pytorch-github call-to-action-any"></span>
            <div class="call-to-action-desktop-view">View on GitHub</div>
            <div class="call-to-action-mobile-view">GitHub</div>
        </div>
    </a>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022 - 2025, DeepPavlov.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.0.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>